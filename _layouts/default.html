<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Lexin Gong{% if page.title %} - {{ page.title }}{% endif %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Lexin Gong,gonglexin,blog">
  <meta name="author" content="gonglexin">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Lexin Gong{% if page.title %} - {{ page.title }}{% endif %}">
  <meta property="og:description" content="Lexin Gong's personal blog - Elixir, Ruby, and tech articles">
  <meta property="og:url" content="https://gonglexin.com{{ page.url }}">
  <meta property="og:site_name" content="Lexin Gong">
  <meta property="og:locale" content="en_US">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@gonglexin">
  <meta name="twitter:title" content="Lexin Gong{% if page.title %} - {{ page.title }}{% endif %}">
  <meta name="twitter:description" content="Lexin Gong's personal blog - Elixir, Ruby, and tech articles">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://gonglexin.com{{ page.url }}">

  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="alternate" type="application/atom+xml" title="Lexin Gong" href="/atom.xml" />

  <!-- Preconnect hints for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cascadia+Code:ital,wght@0,200..700;1,200..700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <!-- <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" /> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />
  <style>
    /* Constrain images and code blocks */
    .prose img,
    .prose pre {
      max-width: 56rem;
      margin-right: auto;
    }
    .prose pre {
      overflow-x: auto;
    }

    /* Custom glx theme - original yellow color scheme */
    [data-theme='glx'] {
      color-scheme: light;
      --p: oklch(75% 0.25 85);
      --pf: oklch(98% 0.01 110);
      --s: oklch(70% 0.20 85);
      --sf: oklch(98% 0.01 110);
      --a: oklch(72% 0.22 85);
      --af: oklch(25% 0.08 60);
      --n: oklch(55% 0.04 60);
      --nf: oklch(98% 0.01 110);
      --b1: oklch(98% 0.03 110);
      --b2: oklch(92% 0.15 110);
      --b3: oklch(87% 0.20 110);
      --bc: oklch(25% 0.08 60);
      --in: oklch(65% 0.20 250);
      --inf: oklch(98% 0.01 110);
      --su: oklch(70% 0.20 140);
      --suf: oklch(98% 0.01 110);
      --wa: oklch(75% 0.25 85);
      --waf: oklch(25% 0.08 60);
      --er: oklch(60% 0.25 25);
      --erf: oklch(98% 0.01 110);

      /* border radius */
      --rounded-box: 0.5rem;
      --rounded-btn: 0.375rem;
      --rounded-badge: 1rem;

      /* base sizes */
      --tab-border: 1px;

      /* effects */
      --ring-offset: 2px;
      --focus-ring: 0 0 0 1px oklch(75% 0.25 85);
    }

    [data-theme='glx'] body {
      background-color: #fefce8 !important;
    }
    [data-theme='glx'] nav {
      background-color: #fefce8 !important;
    }
    [data-theme='glx'] .bg-primary\/20 {
      background-color: rgba(234, 179, 8, 0.2) !important;
    }

    [data-theme='glx'] .btn-ghost:hover {
      background-color: #ea9f31 !important;
      color: #fefce8 !important;
    }

    [data-theme='glx'] .btn-ghost:focus {
      background-color: #ea9f31 !important;
      color: #fefce8 !important;
      outline-color: #d97706 !important;
    }
  </style>
  <script type="module">
    import { codeToHtml } from 'https://esm.sh/shiki@3.13.0';

    // Map DaisyUI themes to Shiki themes
    const themeMapping = {
      'glx': 'snazzy-light',
      'light': 'github-light',
      'dark': 'github-dark',
      'cupcake': 'vitesse-light',
      'bumblebee': 'nord',
      'emerald': 'one-dark-pro',
      'corporate': 'dracula',
      'synthwave': 'nord',
      'retro': 'vitesse-light',
      'cyberpunk': 'material-theme-darker',
      'valentine': 'rose-pine-dawn',
      'halloween': 'dracula',
      'garden': 'nord',
      'forest': 'material-theme-darker',
      'aqua': 'vitesse-light',
      'lofi': 'github-dark-dimmed',
      'pastel': 'vitesse-light',
      'fantasy': 'rose-pine-moon',
      'wireframe': 'github-light',
      'black': 'one-dark-pro',
      'luxury': 'material-theme',
      'dracula': 'dracula',
      'cmyk': 'one-dark-pro',
      'autumn': 'rose-pine',
      'business': 'github-dark',
      'acid': 'vitesse-light',
      'lemonade': 'snazzy-light',
      'night': 'one-dark-pro',
      'coffee': 'rose-pine-moon',
      'winter': 'vitesse-light'
    };

    // Store original HTML before highlighting
    let originalMainHTML = '';

    // Get current theme
    function getCurrentTheme() {
      return document.documentElement.getAttribute('data-theme') || 'glx';
    }

    // Get Shiki theme for current DaisyUI theme
    function getShikiTheme() {
      const currentTheme = getCurrentTheme();
      return themeMapping[currentTheme] || 'snazzy-light';
    }

    async function highlightCode() {
      // Store original HTML on first run
      if (!originalMainHTML) {
        originalMainHTML = document.querySelector('main').innerHTML;
      }

      const preElements = document.querySelectorAll('main pre:not(.shiki)');

      for (const pre of preElements) {
        const code = pre.querySelector('code');
        if (!code) continue;

        const language = code.className.match(/language-(\w+)/)?.[1];
        if (!language) continue;

        const codeContent = code.textContent;

        try {
          const html = await codeToHtml(codeContent, {
            lang: language,
            theme: getShikiTheme()
          });

          pre.outerHTML = html;
        } catch (error) {
          console.error('Shiki highlighting error:', error);
        }
      }
    }

    // Initial highlight
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', highlightCode);
    } else {
      highlightCode();
    }

    // Re-highlight when theme changes
    let debounceTimer;
    document.querySelectorAll('.theme-controller').forEach(radio => {
      radio.addEventListener('change', () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          // Restore original HTML (without highlighting)
          if (originalMainHTML) {
            document.querySelector('main').innerHTML = originalMainHTML;
          }
          // Re-highlight with new theme
          highlightCode();
        }, 100);
      });
    });
  </script>
</head>

<body class="bg-base-100 underline-offset-4 flex flex-col min-h-screen">
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary/20 px-4 py-2 rounded font-bold">Skip to main content</a>

  <header>
    {% include nav.html %}
  </header>

  <main id="main-content" class="px-6 py-4 flex-grow" role="main">{{ content }}</main>

  <footer>
    {% include footer.html %}
  </footer>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M0NGJ4YDCC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-M0NGJ4YDCC');
  </script>

  <script>
    (function() {
      const themeController = document.querySelector('.theme-controller');

      const savedTheme = localStorage.getItem('theme') || 'glx';

      document.documentElement.setAttribute('data-theme', savedTheme);

      document.querySelectorAll('.theme-controller').forEach(radio => {
        if (radio.value === savedTheme) {
          radio.checked = true;
        }
      });

      document.querySelectorAll('.theme-controller').forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.checked) {
            const selectedTheme = this.value;
            document.documentElement.setAttribute('data-theme', selectedTheme);
            localStorage.setItem('theme', selectedTheme);
          }
        });
      });
    })();
  </script>
</body>

</html>
